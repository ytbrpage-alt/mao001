"use strict";exports.id=7554,exports.ids=[7554],exports.modules={86333:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},32933:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},231:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]])},42887:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},83855:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},69436:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},49758:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]])},65071:(e,t,s)=>{s.d(t,{f:()=>Z});var a=s(10326),n=s(17577),r=s(30058),l=s(88129),i=s(48998),d=s(32933),c=s(67211),o=s(87888),u=s(76557);let m=(0,u.Z)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var x=s(94019);let p=(0,u.Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);var h=s(69436),g=s(61824),f=s(21918),v=s(19547),j=s(11891),b=s(33519),N=s(6042),y=s(72832),w=s(94001),A=s(61867);function C({message:e,isOwn:t,showAvatar:s,onReply:n}){let r;return e.deletedAt?a.jsx("div",{className:(0,A.cn)("flex mb-2",t?"justify-end":"justify-start"),children:a.jsx("div",{className:"italic text-neutral-400 text-sm px-4 py-2",children:"Mensagem removida"})}):(0,a.jsxs)("div",{className:(0,A.cn)("flex gap-2 mb-2 group",t?"flex-row-reverse":"flex-row"),children:[s&&!t?a.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center text-brand-600 text-xs font-medium flex-shrink-0",children:e.senderAvatar?a.jsx("img",{src:e.senderAvatar,alt:"",className:"w-full h-full rounded-full object-cover"}):e.senderName.split(" ").map(e=>e[0]).slice(0,2).join("")}):a.jsx("div",{className:"w-8 flex-shrink-0"}),(0,a.jsxs)("div",{className:(0,A.cn)("max-w-[75%] rounded-2xl px-4 py-2 relative",t?"bg-brand-500 text-white rounded-br-md":"bg-white text-neutral-900 rounded-bl-md shadow-soft"),children:[s&&!t&&a.jsx("p",{className:"text-xs font-medium text-brand-600 mb-1",children:e.senderName}),e.replyTo&&(0,a.jsxs)("div",{className:(0,A.cn)("text-xs p-2 rounded-t-lg border-l-2 mb-1",t?"bg-brand-600 border-white/50 text-white/80":"bg-neutral-100 border-neutral-400 text-neutral-600"),children:[a.jsx("p",{className:"font-medium",children:e.replyTo.senderName}),a.jsx("p",{className:"truncate",children:e.replyTo.content})]}),(0,a.jsxs)("div",{children:["text"===e.type&&a.jsx("p",{className:"break-words whitespace-pre-wrap",children:e.content}),"image"===e.type&&e.mediaUrl&&a.jsx("img",{src:e.mediaUrl,alt:"",className:"rounded-lg max-w-full"}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1",children:[a.jsx("span",{className:(0,A.cn)("text-xs",t?"text-white/70":"text-neutral-400"),children:(r=e.createdAt,(0,g.WU)(new Date(r),"HH:mm"))}),t&&(e=>{switch(e){case"sending":return a.jsx(i.Z,{className:"w-3 h-3"});case"sent":return a.jsx(d.Z,{className:"w-3 h-3"});case"delivered":return a.jsx(c.Z,{className:"w-3 h-3"});case"read":return a.jsx(c.Z,{className:"w-3 h-3 text-blue-400"});case"failed":return a.jsx(o.Z,{className:"w-3 h-3 text-red-400"})}})(e.status)]})]}),a.jsx("div",{className:"absolute -top-2 right-0 hidden group-hover:block",children:a.jsx("button",{onClick:()=>n(e),className:"p-1.5 bg-white rounded-full shadow-md hover:bg-neutral-50",title:"Responder",children:a.jsx(m,{className:"w-3 h-3 text-neutral-600"})})})]})]})}function k({date:e}){let t;return(0,a.jsxs)("div",{className:"flex items-center gap-4 my-4",children:[a.jsx("div",{className:"flex-1 h-px bg-neutral-200"}),a.jsx("span",{className:"text-xs text-neutral-500 font-medium",children:(t=e,(0,f.z)(t)?"Hoje":(0,j.K)(t,(0,b.k)((0,v.y)(t),1))?"Ontem":(0,g.WU)(t,"dd 'de' MMMM",{locale:N.F}))}),a.jsx("div",{className:"flex-1 h-px bg-neutral-200"})]})}function M({names:e}){if(0===e.length)return null;let t=1===e.length?`${e[0]} est\xe1 digitando...`:2===e.length?`${e[0]} e ${e[1]} est\xe3o digitando...`:`${e[0]} e mais ${e.length-1} est\xe3o digitando...`;return(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-2 text-sm text-neutral-500 px-4 py-2",children:[(0,a.jsxs)("div",{className:"flex gap-1",children:[a.jsx(r.E.span,{animate:{opacity:[.4,1,.4]},transition:{duration:1.4,repeat:1/0,delay:0},className:"w-2 h-2 bg-neutral-400 rounded-full"}),a.jsx(r.E.span,{animate:{opacity:[.4,1,.4]},transition:{duration:1.4,repeat:1/0,delay:.2},className:"w-2 h-2 bg-neutral-400 rounded-full"}),a.jsx(r.E.span,{animate:{opacity:[.4,1,.4]},transition:{duration:1.4,repeat:1/0,delay:.4},className:"w-2 h-2 bg-neutral-400 rounded-full"})]}),a.jsx("span",{children:t})]})}function Z({conversationId:e}){let{user:t}=(0,w.aC)(),{getConversation:s,getMessages:i,sendMessage:d,markAsRead:c,setTyping:o,isTyping:u}=(0,y.a)(),[f,v]=(0,n.useState)(""),[j,b]=(0,n.useState)(null),N=(0,n.useRef)(null),A=(0,n.useRef)(null),Z=(0,n.useRef)(),D=s(e),I=i(e),T=u[e]||[];(0,n.useCallback)(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[]);let S=(0,n.useCallback)(()=>{t?.id&&(o(e,t.id,!0),Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>{o(e,t.id,!1)},2e3))},[e,t?.id,o]),R=(0,n.useCallback)(()=>{f.trim()&&t&&(d(e,t.id,t.fullName,t.role||"user",f.trim(),"text",j||void 0),v(""),b(null),o(e,t.id,!1),A.current?.focus())},[f,t,e,j,d,o]),L=I.reduce((e,t)=>{let s=(0,g.WU)(new Date(t.createdAt),"yyyy-MM-dd");return e[s]||(e[s]=[]),e[s].push(t),e},{}),U=T.filter(e=>e!==t?.id).map(e=>{let t=D?.participants.find(t=>t.userId===e);return t?.userName.split(" ")[0]||"Algu\xe9m"});return D?(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 bg-neutral-50",children:[Object.entries(L).map(([e,s])=>(0,a.jsxs)("div",{children:[a.jsx(k,{date:new Date(e)}),s.map((e,n)=>{let r=s[n-1],l=!r||r.senderId!==e.senderId||new Date(e.createdAt).getTime()-new Date(r.createdAt).getTime()>6e4;return a.jsx(C,{message:e,isOwn:e.senderId===t?.id,showAvatar:l,onReply:b},e.id)})]},e)),a.jsx(l.M,{children:U.length>0&&a.jsx(M,{names:U})}),a.jsx("div",{ref:N})]}),a.jsx(l.M,{children:j&&a.jsx(r.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-brand-50 border-t border-brand-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3",children:[(0,a.jsxs)("div",{className:"flex-1 border-l-2 border-brand-500 pl-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(m,{className:"w-4 h-4 text-brand-500"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-brand-600",children:["Respondendo a ",j.senderName]})]}),a.jsx("p",{className:"text-sm text-neutral-600 truncate mt-0.5",children:j.content})]}),a.jsx("button",{onClick:()=>b(null),className:"p-1 hover:bg-brand-100 rounded",children:a.jsx(x.Z,{className:"w-5 h-5 text-neutral-500"})})]})})}),a.jsx("div",{className:"p-4 bg-white border-t border-neutral-200",children:(0,a.jsxs)("div",{className:"flex items-end gap-2",children:[a.jsx("button",{className:"p-2 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 rounded-full",children:a.jsx(p,{className:"w-5 h-5"})}),a.jsx("div",{className:"flex-1",children:a.jsx("textarea",{ref:A,value:f,onChange:e=>{v(e.target.value),S()},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),R())},placeholder:"Digite uma mensagem...",className:"w-full px-4 py-2 bg-neutral-100 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-brand-500 max-h-32",rows:1})}),a.jsx("button",{onClick:R,disabled:!f.trim(),className:"p-2 bg-brand-500 text-white rounded-full hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(h.Z,{className:"w-5 h-5"})})]})})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center text-neutral-500",children:"Conversa n\xe3o encontrada"})}},71612:(e,t,s)=>{s.d(t,{p:()=>g});var a=s(10326),n=s(17577),r=s(30058),l=s(24061),i=s(83855),d=s(88307),c=s(39730),o=s(29039),u=s(6042),m=s(72832),x=s(94001),p=s(61867);function h({conversation:e,currentUserId:t,isSelected:s,onClick:n}){let i=e.unreadCount;return(0,a.jsxs)(r.E.button,{whileTap:{scale:.98},onClick:n,className:(0,p.cn)("w-full flex items-center gap-3 p-4 hover:bg-neutral-50 transition-colors",s&&"bg-brand-50"),children:[a.jsx("div",{className:(0,p.cn)("w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0","patient_care"===e.type?"bg-purple-100 text-purple-600":"bg-brand-100 text-brand-600","text-sm font-medium"),children:(()=>{if("patient_care"===e.type)return a.jsx(l.Z,{className:"w-5 h-5"});if("direct"===e.type){let s=e.participants.find(e=>e.userId!==t);return s?.userAvatar?a.jsx("img",{src:s.userAvatar,alt:"",className:"w-full h-full rounded-full object-cover"}):s?.userName.split(" ").map(e=>e[0]).slice(0,2).join("")||"?"}return a.jsx(l.Z,{className:"w-5 h-5"})})()}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("p",{className:(0,p.cn)("font-medium truncate",i>0?"text-neutral-900":"text-neutral-700"),children:(()=>{if("patient_care"===e.type)return`Grupo: ${e.patientName}`;if("direct"===e.type){let s=e.participants.find(e=>e.userId!==t);return s?.userName||"Conversa"}return"Grupo"})()}),e.lastMessage&&a.jsx("span",{className:"text-xs text-neutral-400 flex-shrink-0",children:(0,o.Q)(new Date(e.lastMessage.timestamp),{locale:u.F,addSuffix:!1})})]}),e.lastMessage&&(0,a.jsxs)("p",{className:(0,p.cn)("text-sm truncate mt-0.5",i>0?"text-neutral-700 font-medium":"text-neutral-500"),children:[e.lastMessage.senderName.split(" ")[0],": ",e.lastMessage.content]})]}),i>0&&a.jsx("span",{className:"w-5 h-5 rounded-full bg-brand-500 text-white text-xs flex items-center justify-center flex-shrink-0",children:i>9?"9+":i})]})}function g({onSelectConversation:e,selectedId:t}){let{user:s}=(0,x.aC)(),{getConversationsForUser:r}=(0,m.a)(),[l,o]=(0,n.useState)(""),u=(s?r(s.id):[]).filter(e=>{if(!l)return!0;let t=l.toLowerCase();return!!(e.patientName?.toLowerCase().includes(t)||e.participants.some(e=>e.userName.toLowerCase().includes(t))||e.lastMessage?.content.toLowerCase().includes(t))});return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-white",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-neutral-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Mensagens"}),a.jsx("button",{className:"p-2 bg-brand-500 text-white rounded-full hover:bg-brand-600",children:a.jsx(i.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(d.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400"}),a.jsx("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:"Buscar conversas...",className:"w-full pl-9 pr-4 py-2 bg-neutral-100 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:0===u.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-neutral-500 p-8",children:[a.jsx(c.Z,{className:"w-12 h-12 mb-3 text-neutral-300"}),a.jsx("p",{className:"text-center",children:l?"Nenhuma conversa encontrada":"Nenhuma conversa ainda"})]}):a.jsx("div",{className:"divide-y divide-neutral-100",children:u.map(n=>a.jsx(h,{conversation:n,currentUserId:s?.id||"",isSelected:t===n.id,onClick:()=>e(n.id)},n.id))})})]})}},72832:(e,t,s)=>{s.d(t,{a:()=>l});var a=s(60114),n=s(85251),r=s(47463);let l=(0,a.Ue)()((0,n.tJ)((e,t)=>({conversations:{},messages:{},activeConversationId:null,isLoading:!1,isTyping:{},createConversation:(t,s,a,n)=>{let l=(0,r.Z)(),i=new Date,d={id:l,type:t,patientId:a,patientName:n,participants:s.map(e=>({...e,joinedAt:i,isAdmin:e.isAdmin??!1,canSendMessages:e.canSendMessages??!0,notifications:e.notifications??!0})),unreadCount:0,totalMessages:0,isArchived:!1,isMuted:!1,createdAt:i,updatedAt:i};return e(e=>({conversations:{...e.conversations,[l]:d},messages:{...e.messages,[l]:[]}})),l},getOrCreateDirectConversation:(e,s,a,n,r,l)=>{let{conversations:i}=t(),d=Object.values(i).find(t=>"direct"===t.type&&2===t.participants.length&&t.participants.some(t=>t.userId===e)&&t.participants.some(e=>e.userId===n));return d?d.id:t().createConversation("direct",[{userId:e,userName:s,userRole:a,isAdmin:!1,canSendMessages:!0,notifications:!0},{userId:n,userName:r,userRole:l,isAdmin:!1,canSendMessages:!0,notifications:!0}])},archiveConversation:t=>{e(e=>({conversations:{...e.conversations,[t]:{...e.conversations[t],isArchived:!0,updatedAt:new Date}}}))},unarchiveConversation:t=>{e(e=>({conversations:{...e.conversations,[t]:{...e.conversations[t],isArchived:!1,updatedAt:new Date}}}))},muteConversation:(t,s)=>{e(e=>({conversations:{...e.conversations,[t]:{...e.conversations[t],isMuted:!0,mutedUntil:s,updatedAt:new Date}}}))},unmuteConversation:t=>{e(e=>({conversations:{...e.conversations,[t]:{...e.conversations[t],isMuted:!1,mutedUntil:void 0,updatedAt:new Date}}}))},sendMessage:(t,s,a,n,l,i="text",d)=>{let c=(0,r.Z)(),o=new Date,u={id:c,conversationId:t,senderId:s,senderName:a,senderRole:n,type:i,content:l,status:"sent",readBy:[{userId:s,readAt:o}],replyTo:d?{messageId:d.id,content:d.content.substring(0,100),senderName:d.senderName}:void 0,createdAt:o,updatedAt:o};return e(e=>{let s=e.messages[t]||[],n=e.conversations[t];return{messages:{...e.messages,[t]:[...s,u]},conversations:{...e.conversations,[t]:{...n,lastMessage:{content:"text"===i?l:`[${i}]`,senderName:a,timestamp:o,type:i},totalMessages:n.totalMessages+1,unreadCount:n.unreadCount+(n.participants.length-1),updatedAt:o}}}}),c},updateMessageStatus:(t,s,a)=>{e(e=>({messages:{...e.messages,[t]:e.messages[t]?.map(e=>e.id===s?{...e,status:a,updatedAt:new Date}:e)||[]}}))},markAsRead:(t,s)=>{let a=new Date;e(e=>{let n=e.messages[t]||[],r=e.conversations[t];if(!r)return e;let l=n.map(e=>e.senderId===s||e.readBy.some(e=>e.userId===s)?e:{...e,readBy:[...e.readBy,{userId:s,readAt:a}],status:"read"}),i=r.participants.map(e=>e.userId===s?{...e,lastReadAt:a,lastSeenAt:a}:e),d=l.filter(e=>e.senderId!==s&&e.readBy.length<r.participants.length).length;return{messages:{...e.messages,[t]:l},conversations:{...e.conversations,[t]:{...r,participants:i,unreadCount:d}}}})},markAllAsRead:e=>{let{conversations:s}=t();Object.keys(s).forEach(s=>{t().markAsRead(s,e)})},deleteMessage:(t,s)=>{e(e=>({messages:{...e.messages,[t]:e.messages[t]?.map(e=>e.id===s?{...e,deletedAt:new Date,content:"[Mensagem removida]"}:e)||[]}}))},setTyping:(t,s,a)=>{e(e=>{let n=e.isTyping[t]||[],r=a?[...new Set([...n,s])]:n.filter(e=>e!==s);return{isTyping:{...e.isTyping,[t]:r}}})},setActiveConversation:t=>{e({activeConversationId:t})},getConversation:e=>t().conversations[e]||null,getMessages:e=>t().messages[e]||[],getUnreadTotal:e=>{let{conversations:s}=t();return Object.values(s).filter(t=>t.participants.some(t=>t.userId===e)).reduce((e,t)=>e+t.unreadCount,0)},getConversationsForUser:e=>{let{conversations:s}=t();return Object.values(s).filter(t=>t.participants.some(t=>t.userId===e)&&!t.isArchived).sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())},getPatientCareConversation:e=>{let{conversations:s}=t();return Object.values(s).find(t=>"patient_care"===t.type&&t.patientId===e)||null},searchMessages:(e,s)=>{let{messages:a}=t(),n=e.toLowerCase();return(s?a[s]||[]:Object.values(a).flat()).filter(e=>e.content.toLowerCase().includes(n)&&!e.deletedAt)}}),{name:"maos-amigas-chat",storage:(0,n.FL)(()=>localStorage),partialize:e=>({conversations:e.conversations,messages:e.messages})}))},92977:(e,t,s)=>{s.d(t,{E:()=>r});var a=s(71271),n=s(99276);function r(e,t){let s=(0,a.Q)(e);return isNaN(t)?(0,n.L)(e,NaN):(t&&s.setDate(s.getDate()+t),s)}},11891:(e,t,s)=>{s.d(t,{K:()=>n});var a=s(99515);function n(e,t){return+(0,a.b)(e)==+(0,a.b)(t)}},21918:(e,t,s)=>{s.d(t,{z:()=>r});var a=s(19547),n=s(11891);function r(e){return(0,n.K)(e,(0,a.y)(e))}},33519:(e,t,s)=>{s.d(t,{k:()=>n});var a=s(92977);function n(e,t){return(0,a.E)(e,-t)}}};