(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9555],{4645:function(e,a,s){Promise.resolve().then(s.bind(s,8565))},8565:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return P}});var t=s(7437),l=s(2265),n=s(9376),r=s(2660),i=s(2735),c=s(5621),d=s(6272),o=s(1098),m=s(5859),x=s(521),u=s(8614),h=s(4122),p=s(4862),g=s(8736),j=s(2369),N=s(8906),v=s(8728),f=s(3245),b=s(3639),y=s(2252),w=s(407),_=s(875),M=s(1723),k=s(1001);let Z={evaluation_created:"Avalia\xe7\xe3o criada",evaluation_updated:"Avalia\xe7\xe3o atualizada",evaluation_deleted:"Avalia\xe7\xe3o exclu\xedda",evaluation_status_changed:"Status da avalia\xe7\xe3o alterado",evaluation_exported:"Avalia\xe7\xe3o exportada",discovery_updated:"Descoberta atualizada",patient_updated:"Dados do paciente atualizados",health_history_updated:"Hist\xf3rico de sa\xfade atualizado",abemid_updated:"ABEMID atualizado",katz_updated:"Katz atualizado",lawton_updated:"Lawton atualizado",safety_checklist_updated:"Checklist de seguran\xe7a atualizado",schedule_updated:"Agenda atualizada",results_calculated:"Resultados calculados",proposal_generated:"Proposta gerada",proposal_sent:"Proposta enviada",proposal_accepted:"Proposta aceita",proposal_rejected:"Proposta rejeitada",contract_generated:"Contrato gerado",contract_signed:"Contrato assinado",user_created:"Usu\xe1rio criado",user_updated:"Usu\xe1rio atualizado",user_deleted:"Usu\xe1rio exclu\xeddo",user_login:"Login realizado",user_logout:"Logout realizado",user_pin_changed:"PIN alterado",user_pin_reset:"PIN resetado",user_locked:"Usu\xe1rio bloqueado",user_unlocked:"Usu\xe1rio desbloqueado",sync_started:"Sincroniza\xe7\xe3o iniciada",sync_completed:"Sincroniza\xe7\xe3o conclu\xedda",sync_failed:"Sincroniza\xe7\xe3o falhou",data_exported:"Dados exportados",data_imported:"Dados importados"},z={evaluation:"Avalia\xe7\xe3o",user:"Usu\xe1rio",authentication:"Autentica\xe7\xe3o",system:"Sistema",document:"Documento"},A={evaluation:g.Z,user:j.Z,authentication:N.Z,system:v.Z,document:g.Z},U={info:{bg:"bg-blue-100",icon:f.Z,color:"text-blue-600"},warning:{bg:"bg-yellow-100",icon:b.Z,color:"text-yellow-600"},critical:{bg:"bg-red-100",icon:y.Z,color:"text-red-600"}};function S(e){let{change:a}=e,s=e=>null==e?"(vazio)":"boolean"==typeof e?e?"Sim":"N\xe3o":Array.isArray(e)?e.join(", ")||"(vazio)":"object"==typeof e?JSON.stringify(e):String(e);return(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 text-sm py-1",children:[(0,t.jsxs)("span",{className:"font-medium text-neutral-700",children:[a.fieldLabel,":"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["added"!==a.changeType&&(0,t.jsx)("span",{className:"px-2 py-0.5 bg-red-50 text-red-600 rounded line-through text-xs",children:s(a.previousValue)}),"removed"!==a.changeType&&(0,t.jsxs)(t.Fragment,{children:["modified"===a.changeType&&(0,t.jsx)(w.Z,{className:"w-3 h-3 text-neutral-400"}),(0,t.jsx)("span",{className:"px-2 py-0.5 bg-green-50 text-green-600 rounded text-xs",children:s(a.newValue)})]})]})]})}function C(e){let{entry:a,isLast:s}=e,[n,r]=(0,l.useState)(!1),i=A[a.category],c=U[a.severity],d=c.icon,o=a.changes&&a.changes.length>0;return(0,t.jsxs)("div",{className:"relative flex gap-4",children:[!s&&(0,t.jsx)("div",{className:"absolute left-5 top-10 w-0.5 h-full bg-neutral-200"}),(0,t.jsx)("div",{className:(0,k.cn)("relative z-10 w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",c.bg),children:(0,t.jsx)(d,{className:(0,k.cn)("w-5 h-5",c.color)})}),(0,t.jsx)("div",{className:"flex-1 pb-6",children:(0,t.jsxs)(x.E.div,{className:(0,k.cn)("bg-white rounded-lg border border-neutral-200 p-4",o&&"cursor-pointer hover:border-neutral-300"),onClick:()=>o&&r(!n),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-neutral-900",children:Z[a.eventType]}),(0,t.jsx)("p",{className:"text-sm text-neutral-500 mt-0.5",children:a.description})]}),o&&(0,t.jsx)(x.E.div,{animate:{rotate:n?180:0},className:"text-neutral-400",children:(0,t.jsx)(_.Z,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3 text-xs text-neutral-400",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(M.Z,{className:"w-3 h-3"}),(0,h.WU)(new Date(a.timestamp),"dd/MM/yyyy '\xe0s' HH:mm",{locale:p.F})]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(j.Z,{className:"w-3 h-3"}),a.userName]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(i,{className:"w-3 h-3"}),z[a.category]]})]}),(0,t.jsx)(u.M,{children:n&&o&&(0,t.jsxs)(x.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 pt-4 border-t border-neutral-100 overflow-hidden",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-neutral-500 mb-2",children:"Altera\xe7\xf5es realizadas:"}),(0,t.jsx)("div",{className:"space-y-1",children:a.changes.map((e,a)=>(0,t.jsx)(S,{change:e},a))})]})})]})})]})}function D(e){let{entries:a,maxItems:s,onLoadMore:n,hasMore:r=!1}=e,i=(0,l.useMemo)(()=>{let e=new Map;return(s?a.slice(0,s):a).forEach(a=>{let s=(0,h.WU)(new Date(a.timestamp),"yyyy-MM-dd");e.has(s)||e.set(s,[]),e.get(s).push(a)}),Array.from(e.entries()).map(e=>{let[a,s]=e;return{date:a,label:(0,h.WU)(new Date(a),"EEEE, dd 'de' MMMM",{locale:p.F}),entries:s}})},[a,s]);return 0===a.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(M.Z,{className:"w-12 h-12 text-neutral-300 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-neutral-500",children:"Nenhum registro encontrado"})]}):(0,t.jsxs)("div",{className:"space-y-8",children:[i.map(e=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"h-px flex-1 bg-neutral-200"}),(0,t.jsx)("span",{className:"text-sm font-medium text-neutral-500 capitalize",children:e.label}),(0,t.jsx)("div",{className:"h-px flex-1 bg-neutral-200"})]}),(0,t.jsx)("div",{children:e.entries.map((a,s)=>(0,t.jsx)(C,{entry:a,isLast:s===e.entries.length-1},a.id))})]},e.date)),r&&n&&(0,t.jsx)("div",{className:"text-center pt-4",children:(0,t.jsx)("button",{onClick:n,className:"btn-secondary",children:"Carregar mais"})})]})}var E=s(7168),H=s(9397),T=s(9554);function L(e){let{entityId:a,entityType:s}=e,{getSnapshots:n,compareVersions:r}=(0,o.k)(),i=n(s,a),[c,m]=(0,l.useState)(i.length>=2?i[i.length-2].version:null),[u,p]=(0,l.useState)(i.length>=1?i[i.length-1].version:null),g=(0,l.useMemo)(()=>null===c||null===u?null:r(a,c,u),[a,c,u,r]);if(i.length<2)return(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(d.Z,{className:"w-12 h-12 text-neutral-300 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-neutral-500",children:"\xc9 necess\xe1rio ter pelo menos 2 vers\xf5es para comparar"}),(0,t.jsxs)("p",{className:"text-sm text-neutral-400 mt-1",children:["Vers\xf5es dispon\xedveis: ",i.length]})]});let j=e=>null==e?"—":"boolean"==typeof e?e?"Sim":"N\xe3o":Array.isArray(e)?e.join(", ")||"—":e instanceof Date?(0,h.WU)(e,"dd/MM/yyyy HH:mm"):"object"==typeof e?JSON.stringify(e,null,2):String(e);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"label",children:"Vers\xe3o anterior"}),(0,t.jsx)("select",{value:c||"",onChange:e=>m(Number(e.target.value)),className:"input-base",children:i.slice(0,-1).map(e=>(0,t.jsxs)("option",{value:e.version,children:["Vers\xe3o ",e.version," - ",(0,h.WU)(new Date(e.timestamp),"dd/MM HH:mm")]},e.id))})]}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(d.Z,{className:"w-6 h-6 text-neutral-400"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"label",children:"Vers\xe3o atual"}),(0,t.jsx)("select",{value:u||"",onChange:e=>p(Number(e.target.value)),className:"input-base",children:i.slice(1).map(e=>(0,t.jsxs)("option",{value:e.version,children:["Vers\xe3o ",e.version," - ",(0,h.WU)(new Date(e.timestamp),"dd/MM HH:mm")]},e.id))})]})]}),g&&(0,t.jsx)("div",{className:"bg-neutral-50 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(M.Z,{className:"w-4 h-4 text-neutral-400"}),(0,t.jsxs)("span",{className:"text-neutral-600",children:[(0,h.WU)(new Date(g.previousTimestamp),"dd/MM '\xe0s' HH:mm")," →"," ",(0,h.WU)(new Date(g.currentTimestamp),"dd/MM '\xe0s' HH:mm")]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.Z,{className:"w-4 h-4 text-neutral-400"}),(0,t.jsxs)("span",{className:"text-neutral-600",children:[g.changes.length," altera\xe7\xe3o",1!==g.changes.length?"\xf5es":""]})]})]})}),g&&g.changes.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"font-medium text-neutral-900",children:"Altera\xe7\xf5es detectadas"}),(0,t.jsx)("div",{className:"divide-y divide-neutral-100",children:g.changes.map((e,a)=>(0,t.jsxs)(x.E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*a},className:"py-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:["added"===e.changeType&&(0,t.jsx)("span",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center",children:(0,t.jsx)(H.Z,{className:"w-3 h-3 text-green-600"})}),"removed"===e.changeType&&(0,t.jsx)("span",{className:"w-5 h-5 rounded-full bg-red-100 flex items-center justify-center",children:(0,t.jsx)(T.Z,{className:"w-3 h-3 text-red-600"})}),"modified"===e.changeType&&(0,t.jsx)("span",{className:"w-5 h-5 rounded-full bg-blue-100 flex items-center justify-center",children:(0,t.jsx)(E.Z,{className:"w-3 h-3 text-blue-600"})}),(0,t.jsx)("span",{className:"font-medium text-neutral-800",children:e.fieldLabel})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 ml-7",children:["added"!==e.changeType&&(0,t.jsxs)("div",{className:"p-2 bg-red-50 rounded text-sm",children:[(0,t.jsx)("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Antes"}),(0,t.jsx)("p",{className:"text-red-700 break-words",children:j(e.previousValue)})]}),"removed"!==e.changeType&&(0,t.jsxs)("div",{className:(0,k.cn)("p-2 bg-green-50 rounded text-sm","added"===e.changeType&&"col-span-2"),children:[(0,t.jsx)("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Depois"}),(0,t.jsx)("p",{className:"text-green-700 break-words",children:j(e.newValue)})]})]})]},a))})]}),g&&0===g.changes.length&&(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-neutral-500",children:"Nenhuma diferen\xe7a encontrada entre as vers\xf5es"})})]})}function P(){let e=(0,n.useParams)(),a=(0,n.useRouter)(),s=e.id,{getEntriesByEntity:x,exportLogs:u}=(0,o.k)(),{getEvaluationById:h}=(0,m.q)(),[p,g]=(0,l.useState)("timeline"),[j,N]=(0,l.useState)(1),v=h(s),f=x("evaluation",s),b=f.slice(0,20*j),y=f.length>b.length;return v?(0,t.jsxs)("div",{className:"min-h-screen bg-neutral-50",children:[(0,t.jsx)("div",{className:"bg-white border-b border-neutral-200 sticky top-0 z-10",children:(0,t.jsxs)("div",{className:"container-mobile py-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("button",{onClick:()=>a.back(),className:"p-2 -ml-2 text-neutral-600 hover:bg-neutral-100 rounded-lg",children:(0,t.jsx)(r.Z,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-lg font-bold text-neutral-900",children:"Hist\xf3rico de Altera\xe7\xf5es"}),(0,t.jsx)("p",{className:"text-sm text-neutral-500",children:v.patient.fullName||"Paciente n\xe3o informado"})]}),(0,t.jsx)("button",{onClick:()=>{let e=new Blob([u({entityId:s})],{type:"application/json"}),a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download="historico-avaliacao-".concat(s,".json"),t.click(),URL.revokeObjectURL(a)},className:"p-2 text-neutral-600 hover:bg-neutral-100 rounded-lg",title:"Exportar hist\xf3rico",children:(0,t.jsx)(i.Z,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>g("timeline"),className:(0,k.cn)("flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-lg font-medium transition-colors","timeline"===p?"bg-brand-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"),children:[(0,t.jsx)(c.Z,{className:"w-4 h-4"}),"Timeline"]}),(0,t.jsxs)("button",{onClick:()=>g("compare"),className:(0,k.cn)("flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-lg font-medium transition-colors","compare"===p?"bg-brand-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"),children:[(0,t.jsx)(d.Z,{className:"w-4 h-4"}),"Comparar"]})]})]})}),(0,t.jsx)("div",{className:"container-mobile py-6",children:"timeline"===p?(0,t.jsx)(D,{entries:b,hasMore:y,onLoadMore:()=>N(e=>e+1)}):(0,t.jsx)(L,{entityId:s,entityType:"evaluation"})})]}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("p",{className:"text-neutral-500",children:"Avalia\xe7\xe3o n\xe3o encontrada"})})}}},function(e){e.O(0,[6137,7230,4875,2859,4122,3385,4270,5859,3483,2971,2117,1744],function(){return e(e.s=4645)}),_N_E=e.O()}]);