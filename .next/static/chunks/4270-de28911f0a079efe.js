"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4270],{6812:function(e,a,t){async function n(){let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}async function i(e,a){let t=a||await n(),i=new TextEncoder,s=i.encode(e),r=i.encode(t),c=await crypto.subtle.importKey("raw",s,"PBKDF2",!1,["deriveBits"]);return{hash:Array.from(new Uint8Array(await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},c,256)),e=>e.toString(16).padStart(2,"0")).join(""),salt:t}}async function s(e,a,t){let{hash:n}=await i(e,t);return n===a}function r(){let e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}function c(){let e="maos-amigas-device-id",a=localStorage.getItem(e);if(!a){let t=new Uint8Array(16);crypto.getRandomValues(t),a=Array.from(t,e=>e.toString(16).padStart(2,"0")).join(""),localStorage.setItem(e,a)}return a}t.d(a,{LC:function(){return r},ni:function(){return c},vj:function(){return s},xM:function(){return i}})},4270:function(e,a,t){t.d(a,{v:function(){return u},t:function(){return l}});var n=t(9625),i=t(6885),s=t(9360);let r={admin:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!0,canDeleteEvaluation:!0,canViewAllEvaluations:!0,canManageUsers:!0,canViewUserDetails:!0,canExportData:!0,canViewReports:!0,canViewFinancials:!0,canAccessSettings:!0,canViewAuditLog:!0,canManageTemplates:!0},supervisor:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!0,canDeleteEvaluation:!1,canViewAllEvaluations:!0,canManageUsers:!1,canViewUserDetails:!0,canExportData:!0,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!0,canManageTemplates:!1},evaluator:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!1,canExportData:!1,canViewReports:!1,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},client:{canCreateEvaluation:!1,canEditOwnEvaluation:!1,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!1,canExportData:!1,canViewReports:!1,canViewFinancials:!0,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},caregiver:{canCreateEvaluation:!1,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!1,canExportData:!1,canViewReports:!1,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},nurse:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!0,canExportData:!1,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},nurse_tech:{canCreateEvaluation:!1,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!1,canExportData:!1,canViewReports:!1,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},physiotherapist:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!0,canExportData:!1,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},nutritionist:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!0,canExportData:!1,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},psychologist:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!0,canExportData:!1,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},speech_therapist:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!0,canExportData:!1,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},occupational_therapist:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!1,canDeleteEvaluation:!1,canViewAllEvaluations:!1,canManageUsers:!1,canViewUserDetails:!0,canExportData:!1,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!1},physician:{canCreateEvaluation:!0,canEditOwnEvaluation:!0,canEditAnyEvaluation:!0,canDeleteEvaluation:!1,canViewAllEvaluations:!0,canManageUsers:!1,canViewUserDetails:!0,canExportData:!0,canViewReports:!0,canViewFinancials:!1,canAccessSettings:!1,canViewAuditLog:!1,canManageTemplates:!0}};var c=t(6812);let o={id:"admin-default",fullName:"Administrador",email:"admin@maosamigas.com.br",phone:"(45) 99999-9999",cpf:"000.000.000-00",role:"admin",status:"active",createdAt:new Date,updatedAt:new Date,createdBy:"system",preferences:{autoLogoutMinutes:30,keepLoggedIn:!1,notifyOnSync:!0,notifyOnAssignment:!0,hapticFeedback:!0,fontSize:"medium",highContrast:!1},stats:{totalEvaluations:0,evaluationsThisMonth:0,averageEvaluationTime:0}},l=(0,n.Ue)()((0,i.tJ)((e,a)=>({session:null,isAuthenticated:!1,isLoading:!1,_hasHydrated:!1,users:{},userSalts:{},loginAttempts:[],accountLocks:{},lastActivityAt:null,setHasHydrated:a=>{e({_hasHydrated:a})},loginWithPin:async(t,n)=>{e({isLoading:!0});try{let{users:i,userSalts:s,accountLocks:r,loginAttempts:o}=a(),l=(0,c.ni)(),u=n,d=null;if(u)d=i[u]||null;else for(let[e,a]of Object.entries(i)){let n=s[e];if(n&&await (0,c.vj)(t,a.pinHash,n)){d=a,u=e;break}}if(!d||!u){let a={timestamp:new Date,identifier:"unknown",success:!1,deviceId:l,failureReason:"invalid_pin"};return e({isLoading:!1,loginAttempts:[...o,a]}),{success:!1,error:{code:"invalid_credentials",message:"PIN inv\xe1lido"}}}let w=r[u];if(w&&new Date<new Date(w.unlocksAt))return e({isLoading:!1}),{success:!1,error:{code:"account_locked",message:"Conta bloqueada. Tente novamente em ".concat(Math.ceil((new Date(w.unlocksAt).getTime()-Date.now())/6e4)," minutos"),lockedUntil:new Date(w.unlocksAt)}};if("active"!==d.status)return e({isLoading:!1}),{success:!1,error:{code:"account_inactive",message:"Conta inativa. Entre em contato com o administrador"}};let g=s[u];if(!await (0,c.vj)(t,d.pinHash,g)){let a=o.filter(e=>e.userId===u&&!e.success&&Date.now()-new Date(e.timestamp).getTime()<9e5).length+1,t={timestamp:new Date,userId:u,identifier:d.email,success:!1,deviceId:l,failureReason:"invalid_pin"};if(a>=5){let n={userId:u,lockedAt:new Date,unlocksAt:new Date(Date.now()+9e5),reason:"too_many_attempts",attemptCount:a};return e({isLoading:!1,loginAttempts:[...o,t],accountLocks:{...r,[u]:n}}),{success:!1,error:{code:"account_locked",message:"Muitas tentativas incorretas. Conta bloqueada por ".concat(15," minutos"),lockedUntil:n.unlocksAt},remainingAttempts:0}}return e({isLoading:!1,loginAttempts:[...o,t]}),{success:!1,error:{code:"invalid_credentials",message:"PIN incorreto"},remainingAttempts:5-a}}let E=(0,c.LC)(),p=new Date,v={userId:u,user:d,token:E,expiresAt:new Date(p.getTime()+288e5),createdAt:p,deviceId:l,isOfflineSession:!navigator.onLine},m={timestamp:p,userId:u,identifier:d.email,success:!0,deviceId:l},A={...d,lastLoginAt:p},{[u]:f,...h}=r;return e({session:v,isAuthenticated:!0,isLoading:!1,lastActivityAt:p,loginAttempts:[...o,m],accountLocks:h,users:{...a().users,[u]:A}}),{success:!0,session:v}}catch(a){return e({isLoading:!1}),{success:!1,error:{code:"network_error",message:"Erro ao processar login. Tente novamente."}}}},loginWithEmail:async(t,n)=>{e({isLoading:!0});let{users:i}=a(),s=Object.values(i).find(e=>e.email===t);return s&&s.passwordHash?a().loginWithPin(n,s.id):(e({isLoading:!1}),{success:!1,error:{code:"invalid_credentials",message:"Email ou senha inv\xe1lidos"}})},logout:()=>{e({session:null,isAuthenticated:!1,lastActivityAt:null})},refreshSession:()=>{let{session:t}=a();if(!t)return;let n=new Date;e({session:{...t,expiresAt:new Date(n.getTime()+288e5)},lastActivityAt:n})},createUser:async(t,n)=>{let{users:i,userSalts:r}=a();if(Object.values(i).some(e=>e.email===t.email))throw Error("Email j\xe1 cadastrado");if(Object.values(i).some(e=>e.cpf===t.cpf))throw Error("CPF j\xe1 cadastrado");let{hash:o,salt:l}=await (0,c.xM)(t.initialPin),u=(0,s.Z)(),d=new Date,w={id:u,fullName:t.fullName,email:t.email,phone:t.phone,cpf:t.cpf,pinHash:o,role:t.role,status:"active",registrationNumber:t.registrationNumber,specialization:t.specialization,createdAt:d,updatedAt:d,createdBy:n,preferences:{autoLogoutMinutes:30,keepLoggedIn:!1,notifyOnSync:!0,notifyOnAssignment:!0,hapticFeedback:!0,fontSize:"medium",highContrast:!1},stats:{totalEvaluations:0,evaluationsThisMonth:0,averageEvaluationTime:0}};return e({users:{...i,[u]:w},userSalts:{...r,[u]:l}}),w},updateUser:async(t,n)=>{let{users:i,session:s}=a(),r=i[t];if(!r)throw Error("Usu\xe1rio n\xe3o encontrado");let c={...r,...n,preferences:n.preferences?{...r.preferences,...n.preferences}:r.preferences,updatedAt:new Date},o=(null==s?void 0:s.userId)===t?{...s,user:c}:s;return e({users:{...i,[t]:c},session:o}),c},deleteUser:async t=>{let{users:n}=a(),i=n[t];if(!i)throw Error("Usu\xe1rio n\xe3o encontrado");if("admin"===i.role)throw Error("N\xe3o \xe9 poss\xedvel deletar administradores");let s={...i,status:"inactive",updatedAt:new Date};e({users:{...n,[t]:s}})},changePin:async(t,n,i)=>{let{users:s,userSalts:r}=a(),o=s[t],l=r[t];if(!o||!l)throw Error("Usu\xe1rio n\xe3o encontrado");if(!await (0,c.vj)(n,o.pinHash,l))return!1;let{hash:u,salt:d}=await (0,c.xM)(i),w={...o,pinHash:u,updatedAt:new Date};return e({users:{...s,[t]:w},userSalts:{...r,[t]:d}}),!0},resetPin:async(t,n)=>{let{users:i,userSalts:s,session:r}=a();if((null==r?void 0:r.user.role)!=="admin")throw Error("Apenas administradores podem resetar PINs");let o=i[t];if(!o)throw Error("Usu\xe1rio n\xe3o encontrado");let{hash:l,salt:u}=await (0,c.xM)(n),d={...o,pinHash:l,updatedAt:new Date};return e({users:{...i,[t]:d},userSalts:{...s,[t]:u}}),!0},checkSession:()=>{let{session:e,lastActivityAt:t}=a();if(!e)return!1;if(new Date>new Date(e.expiresAt))return a().logout(),!1;if(t){let n=(Date.now()-new Date(t).getTime())/6e4,i=e.user.preferences.autoLogoutMinutes;if(i>0&&n>i)return a().logout(),!1}return!0},getPermissions:()=>{let{session:e}=a();return e?r[e.user.role]:null},hasPermission:e=>{let t=a().getPermissions();return!!t&&t[e]},isAccountLocked:e=>{let{accountLocks:t}=a(),n=t[e];return!n||new Date>new Date(n.unlocksAt)?null:n},getCurrentUser:()=>{let{session:e}=a();return(null==e?void 0:e.user)||null},getUserById:e=>a().users[e]||null,getAllUsers:()=>Object.values(a().users),getUsersByRole:e=>Object.values(a().users).filter(a=>a.role===e),recordActivity:()=>{e({lastActivityAt:new Date})},checkInactivity:()=>{let{session:e,lastActivityAt:t}=a();if(!e||!t)return!1;let n=(Date.now()-new Date(t).getTime())/6e4,i=e.user.preferences.autoLogoutMinutes;return i>0&&n>i}}),{name:"maos-amigas-auth",storage:(0,i.FL)(()=>localStorage),partialize:e=>({users:e.users,userSalts:e.userSalts,session:e.session,isAuthenticated:e.isAuthenticated,accountLocks:e.accountLocks}),onRehydrateStorage:()=>e=>{e&&((e.setHasHydrated(!0),e.session)?new Date>new Date(e.session.expiresAt)?l.setState({session:null,isAuthenticated:!1,_hasHydrated:!0}):l.setState({isAuthenticated:!0,_hasHydrated:!0}):l.setState({_hasHydrated:!0}))}}));async function u(){let{users:e,userSalts:a}=l.getState();if(0===Object.keys(e).length){let{hash:e,salt:a}=await (0,c.xM)("102030"),t={...o,pinHash:e};l.setState({users:{[o.id]:t},userSalts:{[o.id]:a}}),console.log("Admin padr\xe3o criado. PIN inicial: 102030")}}}}]);